<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ù†ØµØ© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ ÙˆØ§Ù„Ù†Ø´Ø± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©</title>
    <style>
        /* --- CSS: Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨ØµØ±ÙŠ --- */
        :root {
            --primary: #3498db; --bg: #f4f7f6; --card: #ffffff; --text: #1c1e21; --accent: #2ecc71;
        }
        [data-theme="dark"] {
            --bg: #121212; --card: #1e1e1e; --text: #e4e6eb;
        }

        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--bg); color: var(--text); transition: 0.3s; }
        .page { display: none; padding: 20px; padding-bottom: 100px; max-width: 900px; margin: 0 auto; min-height: 100vh; }
        .page.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; height: 75px; background: var(--card);
            display: flex; justify-content: space-around; align-items: center;
            box-shadow: 0 -2px 15px rgba(0,0,0,0.1); z-index: 2000;
        }
        .nav-item { cursor: pointer; text-align: center; flex: 1; color: #888; font-size: 11px; transition: 0.2s; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        .plus-btn { 
            width: 60px; height: 60px; background: var(--primary); color: white !important; 
            border-radius: 50%; display: flex; align-items: center; justify-content: center; 
            font-size: 35px; margin-top: -35px; border: 5px solid var(--bg); box-shadow: 0 4px 12px rgba(52,152,219,0.4);
        }

        /* Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ù„Ø±Ø³Ù… */
        #canvas-container { position: relative; background: #fff; border: 2px solid #ddd; border-radius: 10px; margin: 10px 0; touch-action: none; }
        canvas { width: 100%; height: 450px; cursor: crosshair; }
        .toolbar { display: flex; flex-wrap: wrap; gap: 8px; background: #eee; padding: 10px; border-radius: 8px; margin-bottom: 5px; }
        .tool { padding: 8px; border: 1px solid #ccc; border-radius: 5px; background: white; cursor: pointer; font-size: 13px; }
        
        /* Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ */
        .profile-header { text-align: center; padding: 20px; }
        .user-img { width: 90px; height: 90px; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary); cursor: pointer; }
        .work-img-preview { width: 100px; height: 140px; background: #ddd; border-radius: 8px; display: block; margin: 10px 0; object-fit: cover; }

        input, select, button { width: 100%; padding: 12px; margin: 5px 0; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; }
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; }
        .btn-secondary { background: #95a5a6; }
        .btn-delete { background: #e74c3c; width: auto; padding: 5px 15px; }

        .hidden { display: none; }
        .flex-row { display: flex; gap: 10px; }
    </style>
</head>
<body data-theme="light">

    <main>
        <section id="home" class="page active">
            <h2>ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
            <div class="card">
                <h4>Ø´ÙˆÙ‡Ø¯ Ù…Ø¤Ø®Ø±Ø§Ù‹</h4>
                <div id="history-view">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¹Ù…Ø§Ù„ Ù…Ø´Ù‡ÙˆØ¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</div>
            </div>
            <div class="card">
                <h4>Ø£Ø¹Ù…Ø§Ù„ Ù…Ù‚ØªØ±Ø­Ø©</h4>
                <div id="suggestions">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø§Øª...</div>
            </div>
        </section>

        <section id="recent" class="page">
            <h2>ğŸ•’ Ø¢Ø®Ø± Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</h2>
            <div id="global-works-list"></div>
        </section>

        <section id="add" class="page">
            <h2>â• Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù…Ù„ Ø¬Ø¯ÙŠØ¯</h2>
            <div class="card">
                <select id="work-category" onchange="toggleCreationType()">
                    <option value="new">Ø¹Ù…Ù„ Ø¬Ø¯ÙŠØ¯ ÙƒÙ„ÙŠØ§Ù‹</option>
                    <option value="part">ÙØµÙ„ / Ù…ÙˆØ³Ù… Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø¹Ù…Ù„ Ù‚Ø§Ø¦Ù…</option>
                </select>

                <div id="new-work-meta">
                    <input type="text" id="main-title" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ÙƒÙ„ÙŠ (Ù…Ø«Ø§Ù„: ÙˆÙ† Ø¨ÙŠØ³)">
                    <label>ØºÙ„Ø§Ù Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ÙƒÙ„ÙŠ:</label>
                    <input type="file" id="main-cover" accept="image/*" onchange="previewImg(this, 'prev1')">
                    <img id="prev1" class="work-img-preview">
                </div>

                <div id="part-meta">
                    <input type="text" id="part-title" placeholder="Ø§Ø³Ù… Ø§Ù„ÙØµÙ„ Ø£Ùˆ Ø§Ù„Ù…ÙˆØ³Ù… (Ù…Ø«Ø§Ù„: Ø§Ù„ÙØµÙ„ 100)">
                    <label>ØµÙˆØ±Ø© Ø§Ù„ÙØµÙ„/Ø§Ù„Ù…ÙˆØ³Ù…:</label>
                    <input type="file" id="part-cover" accept="image/*" onchange="previewImg(this, 'prev2')">
                    <img id="prev2" class="work-img-preview">
                </div>

                <hr>
                <h4>Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¹Ù…Ù„</h4>
                <div class="flex-row">
                    <button class="btn-secondary" onclick="setMode('pdf')">Ø±ÙØ¹ Ù…Ù„Ù PDF</button>
                    <button class="btn-secondary" onclick="setMode('draw')">Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ø¯Ø§Ø© Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</button>
                </div>

                <div id="pdf-area" class="hidden">
                    <input type="file" id="pdf-file" accept=".pdf">
                </div>

                <div id="draw-area" class="hidden">
                    <div class="toolbar">
                        <input type="color" id="pen-color" value="#000000">
                        <select id="font-size" style="width: auto;">
                            <option value="16">16px</option>
                            <option value="24">24px</option>
                            <option value="32">32px</option>
                        </select>
                        <button class="tool" onclick="canvasTool='pen'">ğŸ–‹ï¸ Ù‚Ù„Ù…</button>
                        <button class="tool" onclick="canvasTool='text'">ğŸ”¤ Ù†Øµ</button>
                        <button class="tool" onclick="canvasTool='rect'">â¬œ Ù…Ø±Ø¨Ø¹</button>
                        <button class="tool" onclick="canvasTool='circle'">â­• Ø¯Ø§Ø¦Ø±Ø©</button>
                        <button class="tool" onclick="clearCanvas()" style="background:#ffcccc">ğŸ—‘ï¸ Ù…Ø³Ø­</button>
                    </div>
                    <div id="canvas-container">
                        <canvas id="editor-canvas"></canvas>
                    </div>
                    <p style="font-size: 11px;">* Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠÙ…ÙƒÙ†Ùƒ Ø³Ø­Ø¨ Ø§Ù„Ø£Ø´ÙƒØ§Ù„ Ù„ØªØºÙŠÙŠØ± Ø­Ø¬Ù…Ù‡Ø§ (Ù…ÙŠØ²Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©).</p>
                </div>

                <div class="flex-row" style="margin-top: 20px;">
                    <button onclick="saveDraft()" style="background: #f39c12;">Ø­ÙØ¸ ÙƒÙ…Ø³ÙˆØ¯Ø© ğŸ’¾</button>
                    <button onclick="publish()" style="background: #27ae60;">Ù†Ø´Ø± Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¢Ù† ğŸš€</button>
                </div>
            </div>
        </section>

        <section id="categories" class="page">
            <h2>ğŸ“ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="card" style="text-align: center;">ğŸ±<br>Ù…Ø§Ù†Ø¬Ø§</div>
                <div class="card" style="text-align: center;">ğŸ“œ<br>Ù‚ØµØµ</div>
                <div class="card" style="text-align: center;">ğŸ“š<br>ÙƒØªØ¨ Ø¹Ù„Ù…ÙŠØ©</div>
                <div class="card" style="text-align: center;">ğŸ–‹ï¸<br>Ø±ÙˆØ§ÙŠØ§Øª</div>
            </div>
        </section>

        <section id="settings" class="page">
            <h2>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
            <div id="auth-ui">
                <div class="card">
                    <p>ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø­ÙØ¸ Ø£Ø¹Ù…Ø§Ù„Ùƒ ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ù†Ø´Ø§Ø·Ùƒ:</p>
                    <button onclick="login('google')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨ÙˆØ§Ø³Ø·Ø© Google</button>
                </div>
            </div>

            <div id="profile-ui" class="hidden">
                <div class="card profile-header">
                    <input type="file" id="avatar-input" class="hidden" onchange="updateAvatar(this)">
                    <img id="user-avatar" src="https://via.placeholder.com/90" class="user-img" onclick="document.getElementById('avatar-input').click()">
                    <h3 id="u-name">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
                    <input type="text" id="change-name-input" placeholder="Ø§Ø³Ù… Ø¹Ø±Ø¶ Ø¬Ø¯ÙŠØ¯">
                    <button onclick="changeName()">Ø­ÙØ¸ Ø§Ù„Ø§Ø³Ù…</button>
                    <small id="name-error" style="color: red;"></small>
                </div>

                <div class="card">
                    <h4>Ø£Ø¹Ù…Ø§Ù„ÙŠ</h4>
                    <div id="user-works"></div>
                </div>

                <div class="card">
                    <button onclick="toggleDarkMode()">ğŸŒ“ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ (Ù„ÙŠÙ„ÙŠ / Ù†Ù‡Ø§Ø±ÙŠ)</button>
                    <button onclick="logout()" style="background: #c0392b; margin-top: 15px;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>
        </section>
    </main>

    <nav class="bottom-nav">
        <div class="nav-item" onclick="nav('settings', this)">âš™ï¸<br>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
        <div class="nav-item" onclick="nav('categories', this)">ğŸ“<br>Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</div>
        <div class="nav-item" onclick="nav('add', this)"><div class="plus-btn">+</div></div>
        <div class="nav-item" onclick="nav('recent', this)">ğŸ•’<br>Ø§Ù„Ø£Ø¹Ù…Ø§Ù„</div>
        <div class="nav-item active" onclick="nav('home', this)">ğŸ <br>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
    </nav>

    <script>
        /* --- JS: Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠ --- */
        let user = JSON.parse(localStorage.getItem('session')) || null;
        let canvas, ctx, canvasTool = 'pen', isDrawing = false;

        function nav(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            if(id === 'add') initCanvas();
        }

        function initCanvas() {
            canvas = document.getElementById('editor-canvas');
            if(!canvas) return;
            ctx = canvas.getContext('2d');
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = 450;

            canvas.onmousedown = (e) => { isDrawing = true; handleDraw(e); };
            canvas.onmousemove = (e) => { if(isDrawing) handleDraw(e); };
            canvas.onmouseup = () => { isDrawing = false; ctx.beginPath(); };
            
            // Ø¯Ø¹Ù… Ø§Ù„Ù„Ù…Ø³
            canvas.ontouchstart = (e) => { isDrawing = true; handleDraw(e.touches[0]); };
            canvas.ontouchmove = (e) => { handleDraw(e.touches[0]); e.preventDefault(); };
            canvas.ontouchend = () => { isDrawing = false; ctx.beginPath(); };
        }

        function handleDraw(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.strokeStyle = document.getElementById('pen-color').value;

            if(canvasTool === 'pen') {
                ctx.lineTo(x, y);
                ctx.stroke();
            } else if(canvasTool === 'rect') {
                ctx.strokeRect(x, y, 80, 50);
            } else if(canvasTool === 'circle') {
                ctx.beginPath(); ctx.arc(x, y, 30, 0, Math.PI*2); ctx.stroke();
            } else if(canvasTool === 'text') {
                const txt = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ:");
                if(txt) {
                    ctx.font = document.getElementById('font-size').value + "px Arial";
                    ctx.fillStyle = ctx.strokeStyle;
                    ctx.fillText(txt, x, y);
                }
                isDrawing = false;
            }
        }

        function clearCanvas() { ctx.clearRect(0,0,canvas.width, canvas.height); }

        function toggleCreationType() {
            const val = document.getElementById('work-category').value;
            document.getElementById('new-work-meta').style.display = (val === 'new') ? 'block' : 'none';
        }

        function setMode(m) {
            document.getElementById('pdf-area').style.display = (m === 'pdf') ? 'block' : 'none';
            document.getElementById('draw-area').style.display = (m === 'draw') ? 'block' : 'none';
        }

        function previewImg(input, targetId) {
            const reader = new FileReader();
            reader.onload = () => document.getElementById(targetId).src = reader.result;
            reader.readAsDataURL(input.files[0]);
        }

        function login(type) {
            const email = prompt("ØªÙ… Ù…Ø­Ø§ÙƒØ§Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø¬ÙˆØ¬Ù„. Ø£Ø¯Ø®Ù„ Ø¥ÙŠÙ…ÙŠÙ„Ùƒ:");
            if(!email) return;
            user = { email, name: email.split('@')[0], avatar: 'https://via.placeholder.com/90', lastUpdate: 0 };
            localStorage.setItem('session', JSON.stringify(user));
            checkSession();
        }

        function checkSession() {
            if(user) {
                document.getElementById('auth-ui').classList.add('hidden');
                document.getElementById('profile-ui').classList.remove('hidden');
                document.getElementById('u-name').innerText = user.name;
                document.getElementById('user-avatar').src = user.avatar;
            } else {
                document.getElementById('auth-ui').classList.remove('hidden');
                document.getElementById('profile-ui').classList.add('hidden');
            }
        }

        function changeName() {
            const n = document.getElementById('change-name-input').value;
            const now = Date.now();
            if(now - user.lastUpdate < 172800000) { // 2 ÙŠÙˆÙ… Ø¨Ø§Ù„Ù…Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©
                document.getElementById('name-error').innerText = "ÙŠØ¬Ø¨ Ø§Ù†ØªØ¸Ø§Ø± ÙŠÙˆÙ…ÙŠÙ† Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù… Ù…Ø¬Ø¯Ø¯Ø§Ù‹.";
                return;
            }
            user.name = n; user.lastUpdate = now;
            localStorage.setItem('session', JSON.stringify(user));
            checkSession();
            alert("ØªÙ… Ø§Ù„ØªØºÙŠÙŠØ±!");
        }

        function updateAvatar(input) {
            const reader = new FileReader();
            reader.onload = () => { user.avatar = reader.result; localStorage.setItem('session', JSON.stringify(user)); checkSession(); };
            reader.readAsDataURL(input.files[0]);
        }

        function logout() { localStorage.removeItem('session'); user = null; checkSession(); }
        function toggleDarkMode() { document.body.setAttribute('data-theme', document.body.getAttribute('data-theme')==='dark'?'light':'dark'); }

        window.onload = checkSession;
    </script>
</body>
</html>
